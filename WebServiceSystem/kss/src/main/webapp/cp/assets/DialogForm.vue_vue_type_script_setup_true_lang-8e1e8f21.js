import{d as pe,p as ye,u as ge,r as $,a6 as B,aN as ee,o as he,v as G,b as w,c as Ve,e as b,f as F,w as d,l as y,t as r,j as S,I as N,h as I,g as ae,an as L,ae as $e,b1 as z,i as k,a8 as we,E as R,ab as Se,m as ke}from"./index-53093fce.js";const Ce={key:0},Be={key:0},Ee={key:1},Ie={class:"space-x-2"},qe={key:0},le="ujcms_continuous_settings",Oe=pe({__name:"DialogForm",props:{modelValue:{type:Boolean,required:!0},name:{type:String,required:!0},beanId:{type:[Number,String],default:null},beanIds:{type:Array,required:!0},values:{type:Object,required:!0},initValues:{type:Function,required:!0},toValues:{type:Function,required:!0},queryBean:{type:Function,required:!0},createBean:{type:Function,required:!0},updateBean:{type:Function,required:!0},deleteBean:{type:Function,required:!0},disableDelete:{type:Function,default:null},disableEdit:{type:Function,default:null},beforeValidate:{type:Function,default:null},preventSubmit:{type:Function,default:null},addable:{type:Boolean,default:!0},action:{type:String,default:"edit"},showId:{type:Boolean,default:!0},perms:{type:String,default:null},focus:{type:Object,default:null},large:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},labelWidth:{type:String,default:"150px"}},emits:{"update:modelValue":null,"update:values":null,finished:null,beanChange:null,beforeSubmit:null},setup(n,{expose:te,emit:t}){const a=n;function H(){const e=localStorage.getItem(le);return e?JSON.parse(e):{}}function ue(e){localStorage.setItem(le,JSON.stringify(e))}function ne(e){var u;return(u=H()[e])!=null?u:!1}function se(e,l){const u=H();u[e]=l,ue(u)}const{name:O,beanId:K,beanIds:oe,focus:q,values:s,action:ie,modelValue:Q}=ye(a),{t:D}=ge(),j=$(!1),c=$(!1),f=$(ne(O.value)),g=$(),v=$(a.initValues()),P=$(),o=$(),m=$([]),i=B(()=>o.value!=null&&ie.value==="edit"),A=B(()=>!j.value&&!ee.isEqual(P.value,s.value)),h=B(()=>{var e,l;return(l=(e=a.disableEdit)==null?void 0:e.call(a,v.value))!=null?l:!1}),de=B(()=>`${O.value} - ${i.value?`${D(h.value?"detail":"edit")} (ID: ${o.value})`:`${D("add")}`}`),T=async()=>{var e;j.value=!0;try{v.value=o.value!=null?await a.queryBean(o.value):a.initValues(s.value),P.value=o.value!=null?a.toValues(v.value):v.value,t("update:values",ee.cloneDeep(P.value)),t("beanChange",v.value),(e=g.value)==null||e.resetFields()}finally{j.value=!1}};he(()=>t("update:values",a.initValues())),G(Q,()=>{Q.value&&(m.value=oe.value,o.value!==K.value?o.value=K.value:T())}),G(o,()=>{T()}),G(f,()=>se(O.value,f.value));const V=B(()=>m.value.indexOf(o.value)),U=B(()=>V.value>0),M=B(()=>V.value<m.value.length-1),J=()=>{U.value&&(o.value=m.value[V.value-1])},W=()=>{M.value&&(o.value=m.value[V.value+1])},ve=()=>{var e,l;(l=(e=q.value)==null?void 0:e.focus)==null||l.call(e),o.value=void 0},re=()=>{t("update:modelValue",!1)},X=async()=>{c.value=!0;try{await a.deleteBean([o.value]),f.value||t("update:modelValue",!1),M.value?(W(),m.value.splice(V.value-1,1)):U.value?(J(),m.value.splice(V.value+1,1)):t("update:modelValue",!1),R.success(D("success")),t("finished")}finally{c.value=!1}},Y=()=>{P.value=a.toValues(s.value)},Z=async()=>{var e;await((e=a.beforeValidate)==null?void 0:e.call(a,s.value)),g.value.validate(async l=>{var u,C,E,_;if(l){c.value=!0;try{if((C=await((u=a.preventSubmit)==null?void 0:u.call(a,s.value)))!=null&&C)return;t("beforeSubmit",s.value),i.value?(await a.updateBean(s.value),Y()):(await a.createBean(s.value),(_=(E=q.value)==null?void 0:E.focus)==null||_.call(E),t("update:values",a.initValues(s.value)),g.value.resetFields()),R.success(D("success")),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})};return te({form:g,submit:e=>{g.value.validate(async l=>{var u,C;if(l){c.value=!0;try{if((C=await((u=a.preventSubmit)==null?void 0:u.call(a,s.value)))!=null&&C)return;t("beforeSubmit",s.value),await e(s.value,{isEdit:i.value,continuous:f.value,form:g.value,props:a,focus:q.value,loadBean:T,resetOrigValues:Y,emit:t}),f.value||t("update:modelValue",!1),t("finished",v.value)}finally{c.value=!1}}})},remove:async e=>{c.value=!0;try{await e(s.value,{isEdit:i.value,continuous:f.value,form:g.value,props:a,focus:q.value,loadBean:T,emit:t}),f.value||t("update:modelValue",!1),M.value?(W(),m.value.splice(V.value-1,1)):U.value?(J(),m.value.splice(V.value+1,1)):t("update:modelValue",!1),R.success(D("success")),t("finished")}finally{c.value=!1}}}),(e,l)=>{const u=w("el-button"),C=w("el-popconfirm"),E=w("el-button-group"),_=w("el-switch"),ce=w("el-tooltip"),fe=w("el-tag"),be=w("el-form"),me=w("el-dialog"),x=Ve("loading");return b(),F(me,{title:de.value,"close-on-click-modal":!A.value,"model-value":n.modelValue,width:n.large?"98%":"768px",top:n.large?"16px":"8vh","onUpdate:modelValue":l[3]||(l[3]=p=>e.$emit("update:modelValue",p)),onOpened:l[4]||(l[4]=()=>{var p;return!i.value&&((p=S(q))==null?void 0:p.focus())})},{header:d(()=>[y(r(S(O))+" - ",1),i.value?(b(),N("span",Ce,[y(r(e.$t(h.value?"detail":"edit"))+" ",1),n.showId?(b(),N("span",Be,"(ID: "+r(o.value)+")",1)):I("",!0)])):(b(),N("span",Ee,r(e.$t("add")),1))]),default:d(()=>[ae((b(),N("div",Ie,[i.value&&n.addable?(b(),F(u,{key:0,disabled:S(L)(`${n.perms}:create`),type:"primary",icon:S($e),onClick:ve},{default:d(()=>[y(r(e.$t("add")),1)]),_:1},8,["disabled","icon"])):I("",!0),z(e.$slots,"header-action",{bean:v.value,isEdit:i.value,disabled:h.value,unsaved:A.value,disableDelete:n.disableDelete,handleDelete:X},()=>[i.value?(b(),F(C,{key:0,title:e.$t("confirmDelete"),onConfirm:l[0]||(l[0]=()=>X())},{reference:d(()=>{var p;return[k(u,{disabled:((p=n.disableDelete)==null?void 0:p.call(n,v.value))||S(L)(`${n.perms}:delete`),icon:S(Se)},{default:d(()=>[y(r(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]}),_:1},8,["title"])):I("",!0)]),i.value?(b(),F(E,{key:1},{default:d(()=>[k(u,{disabled:!U.value,onClick:J},{default:d(()=>[y(r(e.$t("form.prev")),1)]),_:1},8,["disabled"]),k(u,{disabled:!M.value,onClick:W},{default:d(()=>[y(r(e.$t("form.next")),1)]),_:1},8,["disabled"])]),_:1})):I("",!0),k(u,{type:"primary",onClick:re},{default:d(()=>[y(r(e.$t("back")),1)]),_:1}),k(ce,{content:e.$t("form.continuous"),placement:"top"},{default:d(()=>[k(_,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=p=>f.value=p),size:"small"},null,8,["modelValue"])]),_:1},8,["content"]),A.value?(b(),F(fe,{key:2,type:"danger"},{default:d(()=>[y(r(e.$t("form.unsaved")),1)]),_:1})):I("",!0),z(e.$slots,"header-status",{bean:v.value,isEdit:i.value,disabled:h.value})])),[[x,j.value||c.value]]),k(be,{ref_key:"form",ref:g,class:we(["mt-5","pr-5"]),model:S(s),disabled:h.value,"label-width":n.labelWidth,"label-position":n.labelPosition,"scroll-to-error":""},{default:d(()=>[z(e.$slots,"default",{bean:v.value,isEdit:i.value,disabled:h.value}),h.value?I("",!0):ae((b(),N("div",qe,[z(e.$slots,"footer-action",{bean:v.value,isEdit:i.value,disabled:h.value,handleSubmit:Z},()=>[k(u,{disabled:S(L)(i.value?`${n.perms}:update`:`${n.perms}:create`),type:"primary","native-type":"submit",onClick:l[2]||(l[2]=ke(()=>Z(),["prevent"]))},{default:d(()=>[y(r(e.$t("save")),1)]),_:1},8,["disabled"])])])),[[x,c.value]])]),_:3},8,["model","disabled","label-width","label-position"])]),_:3},8,["title","close-on-click-modal","model-value","width","top"])}}});export{Oe as _};
