import{d as Q,r as m,b as c,e as U,f as R,w as t,j as d,i as l,as as J,I as H,ah as se,ag as W,p as te,u as X,a6 as Y,v as oe,o as Z,a3 as I,k as D,h as x,l as C,t as P,E as ee,c as ne,g as ue,aw as ie,aD as de,aM as re,an as q,ae as me,ab as pe}from"./index-53093fce.js";import{C as le,D as ce,E as ve,F as ae,G as fe,H as be,f as _e,I as ye}from"./user-93bd0dc6.js";import{a as K,_ as ge,b as $e,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-94058d51.js";import{_ as ke}from"./ListMove.vue_vue_type_script_setup_true_lang-f8c04430.js";import{_ as he}from"./DialogForm.vue_vue_type_script_setup_true_lang-8e1e8f21.js";import{t as Ce}from"./tree-e8204b87.js";import{i as Pe}from"./content-428531a8.js";const we={name:"GroupForm"},Ae=Q({...we,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(w){const A=m(),p=m({});return(u,r)=>{const $=c("el-input"),_=c("el-form-item"),V=c("el-switch"),f=c("el-option"),k=c("el-select");return U(),R(he,{values:p.value,"onUpdate:values":r[4]||(r[4]=a=>p.value=a),name:u.$t("menu.user.group"),"query-bean":d(le),"create-bean":d(ce),"update-bean":d(ve),"delete-bean":d(ae),"bean-id":w.beanId,"bean-ids":w.beanIds,focus:A.value,"init-values":()=>({type:2,allAccessPermission:!0}),"to-values":a=>({...a}),"disable-delete":a=>a.id<=10,perms:"group","model-value":w.modelValue,"onUpdate:modelValue":r[5]||(r[5]=a=>u.$emit("update:modelValue",a)),onFinished:r[6]||(r[6]=()=>u.$emit("finished"))},{default:t(({})=>[l(_,{prop:"name",label:u.$t("group.name"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:t(()=>[l($,{ref_key:"focus",ref:A,modelValue:p.value.name,"onUpdate:modelValue":r[0]||(r[0]=a=>p.value.name=a),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),l(_,{prop:"description",label:u.$t("group.description")},{default:t(()=>[l($,{modelValue:p.value.description,"onUpdate:modelValue":r[1]||(r[1]=a=>p.value.description=a),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),l(_,{prop:"allAccessPermission"},{label:t(()=>[l(J,{message:"group.allAccessPermission"})]),default:t(()=>[l(V,{modelValue:p.value.allAccessPermission,"onUpdate:modelValue":r[2]||(r[2]=a=>p.value.allAccessPermission=a)},null,8,["modelValue"])]),_:1}),l(_,{prop:"type",label:u.$t("group.type"),rules:{required:!0,message:()=>u.$t("v.required")}},{default:t(()=>[l(k,{modelValue:p.value.type,"onUpdate:modelValue":r[3]||(r[3]=a=>p.value.type=a),disabled:p.value.type===1},{default:t(()=>[(U(),H(W,null,se([1,2],a=>l(f,{key:a,disabled:a===1,label:u.$t(`group.type.${a}`),value:a},null,8,["disabled","label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label","rules"])]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","disable-delete","model-value"])}}}),De={class:"border-t"},Ue={class:"flex justify-between items-center"},qe={name:"UserPermissionForm"},Ge=Q({...qe,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null}},emits:{"update:modelValue":null,finished:null},setup(w,{emit:A}){const p=w,{beanId:u,modelValue:r}=te(p),{t:$}=X(),_=m(),V=m({}),f=m({}),k=m(!1),a=m(!0),N=m(!1),g=m(),y=m([]),B=Y(()=>I.rank>V.value.rank),L=async()=>{(u==null?void 0:u.value)!=null&&(V.value=await le(u.value),f.value={...V.value})},T=async()=>{y.value=Ce(await Pe())},z=async()=>{var i;if((u==null?void 0:u.value)!=null){const e=await be(u.value);(i=g.value)==null||i.setCheckedKeys([]),e.forEach(s=>{var o;(o=g.value)==null||o.setChecked(s,!0,!1)})}};oe(r,()=>{r.value&&(L(),z())}),Z(()=>{T()});const G=(i,e,s,o)=>{s.forEach(v=>{v.children&&(e.getNode(v[o!=null?o:"key"]).expanded=i,G(i,e,v.children,o))})},M=(i,e,s,o)=>{e.setCheckedKeys(i?s.map(v=>v[o!=null?o:"key"]):[])},S=()=>{_.value.validate(async i=>{if(i){k.value=!0;try{await fe(f.value),A("finished"),A("update:modelValue",!1),ee.success($("success"))}finally{k.value=!1}}})},E=()=>{g.value!=null&&(f.value.accessPermissions=[...g.value.getCheckedNodes(),...g.value.getHalfCheckedNodes()].map(i=>i.id))};return(i,e)=>{const s=c("el-switch"),o=c("el-form-item"),v=c("el-checkbox"),h=c("el-tree"),j=c("el-form"),O=c("el-tag"),F=c("el-button"),n=c("el-drawer");return U(),R(n,{title:i.$t("permissionSettings"),"model-value":w.modelValue,size:414,"onUpdate:modelValue":e[8]||(e[8]=b=>i.$emit("update:modelValue",b))},{default:t(()=>[l(j,{ref_key:"form",ref:_,model:f.value,disabled:B.value,"label-width":"150px"},{default:t(()=>[l(o,{prop:"allAccessPermission"},{label:t(()=>[l(J,{message:"group.allAccessPermission",help:""})]),default:t(()=>[l(s,{modelValue:f.value.allAccessPermission,"onUpdate:modelValue":e[0]||(e[0]=b=>f.value.allAccessPermission=b)},null,8,["modelValue"])]),_:1}),f.value.allAccessPermission?x("",!0):(U(),H(W,{key:0},[D("div",De,[l(v,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=b=>a.value=b),label:i.$t("expand/collapse"),onChange:e[2]||(e[2]=b=>G(b,g.value,y.value,"id"))},null,8,["modelValue","label"]),l(v,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=b=>N.value=b),label:i.$t("checkAll/uncheckAll"),onChange:e[4]||(e[4]=b=>{M(b,g.value,y.value,"id"),E()})},null,8,["modelValue","label"])]),l(h,{ref_key:"accessPermissionTree",ref:g,data:y.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expand-all":"","show-checkbox":"",onCheck:e[5]||(e[5]=()=>E())},null,8,["data"])],64))]),_:1},8,["model","disabled"])]),footer:t(()=>[D("div",Ue,[D("div",null,[l(O,null,{default:t(()=>{var b;return[C(P((b=f.value)==null?void 0:b.name),1)]}),_:1})]),D("div",null,[l(F,{onClick:e[6]||(e[6]=()=>i.$emit("update:modelValue",!1))},{default:t(()=>[C(P(i.$t("cancel")),1)]),_:1}),l(F,{type:"primary",loading:k.value,disabled:B.value,onClick:e[7]||(e[7]=()=>S())},{default:t(()=>[C(P(i.$t("save")),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["title","model-value"])}}}),Se={class:"mb-3"},Ee={class:"app-block mt-3"},Ie={name:"GroupList"},Me=Q({...Ie,setup(w){const{t:A}=X(),p=m({}),u=m(),r=m(),$=m([]),_=m([]),V=m(!1),f=m(!1),k=m(!1),a=m(),N=Y(()=>$.value.map(e=>e.id)),g=m(!1),y=async()=>{V.value=!0;try{$.value=await _e({...ie(p.value),Q_OrderBy:u.value}),g.value=Object.values(p.value).filter(e=>e!==void 0&&e!=="").length>0||u.value!==void 0}finally{V.value=!1}};Z(y);const B=({column:e,prop:s,order:o})=>{var v;s&&o?u.value=((v=e.sortBy)!=null?v:s)+(o==="descending"?"_desc":""):u.value=void 0,y()},L=()=>y(),T=()=>{r.value.clearSort(),de(p.value),u.value=void 0,y()},z=()=>{a.value=void 0,f.value=!0},G=e=>{a.value=e,f.value=!0},M=e=>{a.value=e,k.value=!0},S=e=>e>10,E=async e=>{const s=e.filter(o=>S(o));s.length>0&&(await ae(s),y(),ee.success(A("success")))},i=async(e,s)=>{const o=re(e,$.value,s);await ye(o.map(v=>v.id))};return(e,s)=>{const o=c("el-button"),v=c("el-popconfirm"),h=c("el-table-column"),j=c("el-tag"),O=c("el-table"),F=ne("loading");return U(),H("div",null,[D("div",Se,[l(d(ge),{params:p.value,onSearch:L,onReset:T},{default:t(()=>[l(d(K),{label:e.$t("group.name"),name:"Q_Contains_name"},null,8,["label"]),l(d(K),{label:e.$t("group.description"),name:"Q_Contains_description"},null,8,["label"])]),_:1},8,["params"])]),D("div",null,[l(o,{type:"primary",disabled:d(q)("group:create"),icon:d(me),onClick:z},{default:t(()=>[C(P(e.$t("add")),1)]),_:1},8,["disabled","icon"]),l(v,{title:e.$t("confirmDelete"),onConfirm:s[0]||(s[0]=()=>E(_.value.map(n=>n.id)))},{reference:t(()=>[l(o,{disabled:_.value.filter(n=>S(n.id)).length<=0||d(q)("group:delete"),icon:d(pe)},{default:t(()=>[C(P(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),l(ke,{class:"ml-2",disabled:_.value.length<=0||g.value||d(q)("org:update"),onMove:s[1]||(s[1]=n=>i(_.value,n))},null,8,["disabled"]),l(d($e),{name:"group",class:"ml-2"})]),D("div",Ee,[ue((U(),R(O,{ref_key:"table",ref:r,data:$.value,onSelectionChange:s[2]||(s[2]=n=>_.value=n),onRowDblclick:s[3]||(s[3]=n=>G(n.id)),onSortChange:B},{default:t(()=>[l(d(Ve),{name:"group"},{default:t(()=>[l(h,{type:"selection",width:"50"}),l(h,{property:"id",label:"ID",width:"80",sortable:"custom"}),l(h,{property:"name",label:e.$t("group.name"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"description",label:e.$t("group.description"),"min-width":"150",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),l(h,{property:"allAccessPermission",label:e.$t("group.allAccessPermission"),sortable:"custom"},{default:t(({row:n})=>[l(j,{type:n.allAccessPermission?"success":"info",size:"small"},{default:t(()=>[C(P(e.$t(n.allAccessPermission?"yes":"no")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(h,{property:"type",label:e.$t("group.type"),sortable:"custom","show-overflow-tooltip":"",formatter:n=>e.$t(`group.type.${n.type}`)},null,8,["label","formatter"]),l(h,{label:e.$t("table.action")},{default:t(({row:n})=>[l(o,{type:"primary",disabled:d(q)("group:update"),size:"small",link:"",onClick:b=>G(n.id)},{default:t(()=>[C(P(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),d(I).epRank>0||d(I).epDisplay?(U(),R(o,{key:0,type:"primary",disabled:d(q)("group:updatePermission")||d(I).epRank<=0,title:d(I).epRank<=0?e.$t("error.enterprise.short"):void 0,size:"small",link:"",onClick:()=>M(n.id)},{default:t(()=>[C(P(e.$t("permissionSettings")),1)]),_:2},1032,["disabled","title","onClick"])):x("",!0),l(v,{title:e.$t("confirmDelete"),onConfirm:()=>E([n.id])},{reference:t(()=>[l(o,{type:"primary",disabled:!S(n.id)||d(q)("group:delete"),size:"small",link:""},{default:t(()=>[C(P(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[F,V.value]])]),l(Ae,{modelValue:f.value,"onUpdate:modelValue":s[4]||(s[4]=n=>f.value=n),"bean-id":a.value,"bean-ids":N.value,onFinished:y},null,8,["modelValue","bean-id","bean-ids"]),l(Ge,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=n=>k.value=n),"bean-id":a.value,onFinished:y},null,8,["modelValue","bean-id"])])}}});export{Me as default};
