import{d as j,r as i,b as m,e as _,f as $,w as a,j as s,i as e,as as g,U as F,l as f,t as b,h as Z,u as x,a6 as ee,o as ae,c as le,I as C,k as B,g as oe,aw as te,aD as ne,E as se,ag as N,ah as P,an as I,ab as ue,aB as re,aC as de}from"./index-53093fce.js";import{l as pe,c as ie}from"./data-619fd67e.js";import{i as me,j as ve,k as ge,l as H,m as fe}from"./log-45dd3e1c.js";import{a as k,_ as be,b as _e,c as ye}from"./QueryItem.vue_vue_type_script_setup_true_lang-94058d51.js";import{_ as ce}from"./DialogForm.vue_vue_type_script_setup_true_lang-8e1e8f21.js";const $e={name:"OperationLogForm"},Le=j({...$e,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0}},emits:{"update:modelValue":null,finished:null},setup(V){const E=i(),t=i({});return(p,y)=>{const d=m("el-input"),u=m("el-form-item"),r=m("el-col"),w=m("el-tag"),Q=m("el-row");return _(),$(ce,{values:t.value,"onUpdate:values":y[0]||(y[0]=v=>t.value=v),name:p.$t("menu.log.operationLog"),"query-bean":s(me),"create-bean":s(ve),"update-bean":s(ge),"delete-bean":s(H),"bean-id":V.beanId,"bean-ids":V.beanIds,focus:E.value,"init-values":()=>({}),"to-values":v=>({...v}),perms:"operationLog","model-value":V.modelValue,addable:!1,large:"","onUpdate:modelValue":y[1]||(y[1]=v=>p.$emit("update:modelValue",v)),onFinished:y[2]||(y[2]=()=>p.$emit("finished"))},{default:a(({})=>[e(Q,null,{default:a(()=>[e(r,{span:12},{default:a(()=>[e(u,{prop:"name"},{label:a(()=>[e(g,{message:"operationLog.name"})]),default:a(()=>[e(d,{"model-value":t.value.name&&p.$t(`log.${t.value.name}`),readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"module"},{label:a(()=>[e(g,{message:"operationLog.module"})]),default:a(()=>[e(d,{"model-value":t.value.module&&p.$t(`log.${t.value.module}`),readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"user"},{label:a(()=>[e(g,{message:"operationLog.user"})]),default:a(()=>{var v;return[e(d,{"model-value":(v=t.value.user)==null?void 0:v.username,readonly:""},null,8,["model-value"])]}),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"created"},{label:a(()=>[e(g,{message:"operationLog.created"})]),default:a(()=>[e(d,{"model-value":s(F)(t.value.created).format("YYYY-MM-DD HH:mm:ss"),readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"ip"},{label:a(()=>[e(g,{message:"operationLog.ip"})]),default:a(()=>[e(d,{"model-value":t.value.ip,readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"requestMethod"},{label:a(()=>[e(g,{message:"operationLog.requestMethod"})]),default:a(()=>[e(d,{"model-value":t.value.requestMethod,readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"type"},{label:a(()=>[e(g,{message:"operationLog.type"})]),default:a(()=>[e(w,{size:"small"},{default:a(()=>[f(b(t.value.type!=null&&p.$t(`operationLog.type.${t.value.type}`)),1)]),_:1})]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(u,{prop:"status"},{label:a(()=>[e(g,{message:"operationLog.status"})]),default:a(()=>[t.value.status===1?(_(),$(w,{key:0,type:"success",size:"small"},{default:a(()=>[f(b(t.value.status&&p.$t(`operationLog.status.${t.value.status}`)),1)]),_:1})):(_(),$(w,{key:1,type:"danger",size:"small"},{default:a(()=>[f(b(t.value.status!=null&&p.$t(`operationLog.status.${t.value.status}`)),1)]),_:1}))]),_:1})]),_:1}),e(r,{span:24},{default:a(()=>[e(u,{prop:"requestUrl"},{label:a(()=>[e(g,{message:"operationLog.requestUrl"})]),default:a(()=>[e(d,{"model-value":t.value.requestUrl,type:"textarea",rows:"2",readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:24},{default:a(()=>[e(u,{prop:"requestBody"},{label:a(()=>[e(g,{message:"operationLog.requestBody"})]),default:a(()=>[e(d,{"model-value":t.value.requestBody,type:"textarea",autosize:{minRows:3,maxRows:18},readonly:""},null,8,["model-value"])]),_:1})]),_:1}),e(r,{span:24},{default:a(()=>[e(u,{prop:"responseEntity"},{label:a(()=>[e(g,{message:"operationLog.responseEntity"})]),default:a(()=>[e(d,{"model-value":t.value.responseEntity,type:"textarea",autosize:{minRows:3,maxRows:24},readonly:""},null,8,["model-value"])]),_:1})]),_:1}),t.value.exceptionStack!=null?(_(),$(r,{key:0,span:24},{default:a(()=>[e(u,{prop:"exceptionStack"},{label:a(()=>[e(g,{message:"operationLog.exceptionStack"})]),default:a(()=>[e(d,{"model-value":t.value.exceptionStack,type:"textarea",autosize:{minRows:3,maxRows:18},readonly:""},null,8,["model-value"])]),_:1})]),_:1})):Z("",!0)]),_:1})]),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","to-values","model-value"])}}}),we={class:"mb-3"},ke={class:"app-block mt-3"},Qe={name:"OperationLogList"},De=j({...Qe,setup(V){const{t:E}=x(),t=i({}),p=i(),y=i(1),d=i(10),u=i(0),r=i(),w=i([]),Q=i([]),v=i(!1),h=i(!1),U=i(),T=ee(()=>w.value.map(o=>o.id)),L=async()=>{v.value=!0;try{const{content:o,totalElements:n}=await fe({...te(t.value),Q_OrderBy:p.value,page:y.value,pageSize:d.value});w.value=o,u.value=n}finally{v.value=!1}};ae(L);const A=({column:o,prop:n,order:z})=>{var S;n&&z?p.value=((S=o.sortBy)!=null?S:n)+(z==="descending"?"_desc":""):p.value=void 0,L()},G=()=>L(),W=()=>{r.value.clearSort(),ne(t.value),p.value=void 0,L()},M=o=>{U.value=o,h.value=!0},R=async o=>{await H(o),L(),se.success(E("success"))};return(o,n)=>{const z=m("el-option"),S=m("el-select"),D=m("el-button"),O=m("el-popconfirm"),c=m("el-table-column"),q=m("el-tag"),J=m("el-table"),K=m("el-pagination"),X=le("loading");return _(),C("div",null,[B("div",we,[e(s(be),{params:t.value,onSearch:G,onReset:W},{default:a(()=>[e(s(k),{label:o.$t("operationLog.module"),name:"Q_EQ_module"},{default:a(()=>[e(S,{modelValue:t.value.Q_EQ_module,"onUpdate:modelValue":n[0]||(n[0]=l=>t.value.Q_EQ_module=l),class:"w-96"},{default:a(()=>[(_(!0),C(N,null,P(s(pe),l=>(_(),$(z,{key:l,label:o.$t(`log.${l}`),value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(s(k),{label:o.$t("operationLog.name"),name:"Q_EQ_name"},{default:a(()=>[e(S,{modelValue:t.value.Q_EQ_name,"onUpdate:modelValue":n[1]||(n[1]=l=>t.value.Q_EQ_name=l),class:"w-96"},{default:a(()=>[(_(!0),C(N,null,P(s(ie).filter(l=>{var Y;return l.startsWith((Y=t.value.Q_EQ_module)!=null?Y:"")}),l=>(_(),$(z,{key:l,label:o.$t(`log.${l}`),value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(s(k),{label:o.$t("operationLog.user"),name:"Q_Like_user-username"},null,8,["label"]),e(s(k),{label:o.$t("operationLog.ip"),name:"Q_Like_ip"},null,8,["label"]),e(s(k),{label:o.$t("operationLog.created"),name:"Q_GE_created_DateTime,Q_LE_created_DateTime",type:"datetime"},null,8,["label"]),e(s(k),{label:o.$t("operationLog.type"),name:"Q_In_type_Short",options:[1,2,3,0].map(l=>({label:o.$t(`operationLog.type.${l}`),value:l}))},null,8,["label","options"]),e(s(k),{label:o.$t("operationLog.status"),name:"Q_In_status_Short",options:[1,0].map(l=>({label:o.$t(`operationLog.status.${l}`),value:l}))},null,8,["label","options"])]),_:1},8,["params"])]),B("div",null,[e(O,{title:o.$t("confirmDelete"),onConfirm:n[2]||(n[2]=()=>R(Q.value.map(l=>l.id)))},{reference:a(()=>[e(D,{disabled:Q.value.length<=0||s(I)("operationLog:delete"),icon:s(ue)},{default:a(()=>[f(b(o.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),e(s(_e),{name:"operationLog",class:"ml-2"})]),B("div",ke,[oe((_(),$(J,{ref_key:"table",ref:r,data:w.value,onSelectionChange:n[3]||(n[3]=l=>Q.value=l),onRowDblclick:n[4]||(n[4]=l=>M(l.id)),onSortChange:A},{default:a(()=>[e(s(ye),{name:"operationLog"},{default:a(()=>[e(c,{type:"selection",width:"38"}),e(c,{property:"id",label:"ID",width:"80",sortable:"custom"}),e(c,{property:"module",label:o.$t("operationLog.module"),sortable:"custom","show-overflow-tooltip":""},{default:a(({row:l})=>[f(b(l.module&&o.$t(`log.${l.module}`)),1)]),_:1},8,["label"]),e(c,{property:"name",label:o.$t("operationLog.name"),sortable:"custom","show-overflow-tooltip":""},{default:a(({row:l})=>[f(b(l.name&&o.$t(`log.${l.name}`)),1)]),_:1},8,["label"]),e(c,{property:"user.username",label:o.$t("operationLog.user"),"sort-by":"user-username",sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(c,{property:"ip",label:o.$t("operationLog.ip"),sortable:"custom","show-overflow-tooltip":""},null,8,["label"]),e(c,{property:"created",label:o.$t("operationLog.created"),"min-width":"120",sortable:"custom","show-overflow-tooltip":""},{default:a(({row:l})=>[f(b(s(F)(l.created).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),e(c,{property:"type",label:o.$t("operationLog.type"),width:"80"},{default:a(({row:l})=>[e(q,{size:"small"},{default:a(()=>[f(b(o.$t(`operationLog.type.${l.type}`)),1)]),_:2},1024)]),_:1},8,["label"]),e(c,{property:"status",label:o.$t("operationLog.status"),width:"80"},{default:a(({row:l})=>[l.status===1?(_(),$(q,{key:0,type:"success",size:"small"},{default:a(()=>[f(b(o.$t(`operationLog.status.${l.status}`)),1)]),_:2},1024)):(_(),$(q,{key:1,type:"danger",size:"small"},{default:a(()=>[f(b(o.$t(`operationLog.status.${l.status}`)),1)]),_:2},1024))]),_:1},8,["label"]),e(c,{label:o.$t("table.action")},{default:a(({row:l})=>[e(D,{type:"primary",disabled:s(I)("operationLog:show"),size:"small",link:"",onClick:()=>M(l.id)},{default:a(()=>[f(b(o.$t("view")),1)]),_:2},1032,["disabled","onClick"]),e(O,{title:o.$t("confirmDelete"),onConfirm:()=>R([l.id])},{reference:a(()=>[e(D,{type:"primary",disabled:s(I)("operationLog:delete"),size:"small",link:""},{default:a(()=>[f(b(o.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[X,v.value]]),e(K,{"current-page":y.value,"onUpdate:currentPage":n[5]||(n[5]=l=>y.value=l),pageSize:d.value,"onUpdate:pageSize":n[6]||(n[6]=l=>d.value=l),total:u.value,"page-sizes":s(re),layout:s(de),small:"",background:"",class:"px-3 py-2 justify-end",onSizeChange:n[7]||(n[7]=()=>L()),onCurrentChange:n[8]||(n[8]=()=>L())},null,8,["current-page","pageSize","total","page-sizes","layout"])]),e(Le,{modelValue:h.value,"onUpdate:modelValue":n[9]||(n[9]=l=>h.value=l),"bean-id":U.value,"bean-ids":T.value,onFinished:L},null,8,["modelValue","bean-id","bean-ids"])])}}});export{De as default};
