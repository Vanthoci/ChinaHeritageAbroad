import{d as F,p as Y,r,v as Z,b as g,e as B,f as R,w as u,j as n,i as a,h as M,u as x,a6 as ee,o as ae,c as le,I as te,k as T,g as ne,aw as oe,aD as se,E as de,aG as ue,l as I,t as D,ae as re,ab as ie,an as S,a3 as me}from"./index-53093fce.js";import{b as pe,t as P,f as be,g as ve}from"./tree-e8204b87.js";import{q as K,x as fe,y as ce,z as ge,A as H,B as ye}from"./user-93bd0dc6.js";import{a as N,_ as _e,b as $e,c as Ve}from"./QueryItem.vue_vue_type_script_setup_true_lang-94058d51.js";import{_ as ke}from"./ListMove.vue_vue_type_script_setup_true_lang-f8c04430.js";import{_ as he}from"./DialogForm.vue_vue_type_script_setup_true_lang-8e1e8f21.js";const we={name:"OrgForm"},Ce=F({...we,props:{modelValue:{type:Boolean,required:!0},beanId:{type:Number,default:null},beanIds:{type:Array,required:!0},parentId:{type:Number,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(U,{emit:E}){const k=U,{parentId:y,beanId:q,showGlobalData:b,modelValue:c}=Y(k),h=r(),d=r({}),f=r([]),O=async o=>{f.value=pe(P(await K({current:!b.value})),o==null?void 0:o.id)},w=async o=>{await O(o),E("finished")};return Z(c,()=>{c.value&&O()}),(o,t)=>{const L=g("el-tree-select"),i=g("el-form-item"),C=g("el-input");return B(),R(he,{values:d.value,"onUpdate:values":t[5]||(t[5]=p=>d.value=p),name:o.$t("menu.user.org"),"query-bean":n(fe),"create-bean":n(ce),"update-bean":n(ge),"delete-bean":n(H),"bean-id":n(q),"bean-ids":U.beanIds,focus:h.value,"init-values":p=>({parentId:n(y)}),"to-values":p=>({...p}),"disable-delete":p=>{var _;return p.id<=1||p.id===((_=f.value[0])==null?void 0:_.id)},perms:"org","model-value":U.modelValue,"onUpdate:modelValue":t[6]||(t[6]=p=>o.$emit("update:modelValue",p)),onFinished:w,onBeanChange:t[7]||(t[7]=()=>O())},{default:u(({isEdit:p})=>{var _;return[!p||d.value.id!==((_=f.value[0])==null?void 0:_.id)?(B(),R(i,{key:0,prop:"parentId",label:o.$t("org.parent"),rules:{required:!0,message:()=>o.$t("v.required")}},{default:u(()=>[a(L,{modelValue:d.value.parentId,"onUpdate:modelValue":t[0]||(t[0]=m=>d.value.parentId=m),data:f.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":f.value.map(m=>m.id),"render-after-expand":!1,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys"])]),_:1},8,["label","rules"])):M("",!0),a(i,{prop:"name",label:o.$t("org.name"),rules:{required:!0,message:()=>o.$t("v.required")}},{default:u(()=>[a(C,{ref_key:"focus",ref:h,modelValue:d.value.name,"onUpdate:modelValue":t[1]||(t[1]=m=>d.value.name=m),maxlength:"50"},null,8,["modelValue"])]),_:1},8,["label","rules"]),a(i,{prop:"address",label:o.$t("org.address")},{default:u(()=>[a(C,{modelValue:d.value.address,"onUpdate:modelValue":t[2]||(t[2]=m=>d.value.address=m),maxlength:"255"},null,8,["modelValue"])]),_:1},8,["label"]),a(i,{prop:"phone",label:o.$t("org.phone")},{default:u(()=>[a(C,{modelValue:d.value.phone,"onUpdate:modelValue":t[3]||(t[3]=m=>d.value.phone=m),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"]),a(i,{prop:"contacts",label:o.$t("org.contacts")},{default:u(()=>[a(C,{modelValue:d.value.contacts,"onUpdate:modelValue":t[4]||(t[4]=m=>d.value.contacts=m),maxlength:"100"},null,8,["modelValue"])]),_:1},8,["label"])]}),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","disable-delete","model-value"])}}}),Ie={class:"mb-3"},De={class:"mt-3 app-block"},qe={name:"OrgList"},Ee=F({...qe,setup(U){const{t:E}=x(),k=r({}),y=r(),q=r(),b=r([]),c=r([]),h=r(!1),d=r(!1),f=r(),O=ee(()=>b.value.map(e=>e.id)),w=r(!1),o=r(1),t=r(!1),L=r(["1"]),i=async()=>{var e;h.value=!0;try{b.value=await K({...oe(k.value),current:!t.value,Q_OrderBy:y.value}),w.value=Object.values(k.value).filter(l=>l!==void 0&&l!=="").length>0||y.value!==void 0,w.value||(b.value=P(b.value)),o.value=(e=b.value[0])==null?void 0:e.id}finally{h.value=!1}};ae(i);const C=({column:e,prop:l,order:v})=>{var $;l&&v?y.value=(($=e.sortBy)!=null?$:l)+(v==="descending"?"_desc":""):y.value=void 0,i()},p=()=>i(),_=()=>{q.value.clearSort(),se(k.value),y.value=void 0,i()},m=e=>{f.value=void 0,e!=null&&(o.value=e),d.value=!0},z=e=>{f.value=e,d.value=!0},G=async e=>{await H(e),i(),de.success(E("success"))},j=e=>e.id>1,J=async(e,l)=>{const v=ue(e,be(b.value),l);await ye(v),await i(),e.forEach($=>{q.value.toggleRowSelection(ve(b.value,Q=>Q.id===$.id))})};return(e,l)=>{const v=g("el-button"),$=g("el-popconfirm"),Q=g("el-checkbox"),V=g("el-table-column"),W=g("el-table"),X=le("loading");return B(),te("div",null,[T("div",Ie,[a(n(_e),{params:k.value,onSearch:p,onReset:_},{default:u(()=>[a(n(N),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),a(n(N),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),a(n(N),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),a(n(N),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])]),_:1},8,["params"])]),T("div",null,[a(v,{type:"primary",icon:n(re),onClick:l[0]||(l[0]=()=>m())},{default:u(()=>[I(D(e.$t("add")),1)]),_:1},8,["icon"]),a($,{title:e.$t("confirmDelete"),onConfirm:l[1]||(l[1]=()=>G(c.value.map(s=>s.id)))},{reference:u(()=>[a(v,{disabled:c.value.length<=0,icon:n(ie)},{default:u(()=>[I(D(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),a(ke,{class:"ml-2",disabled:c.value.length<=0||w.value||n(S)("org:update"),onMove:l[2]||(l[2]=s=>J(c.value,s))},null,8,["disabled"]),n(me).globalPermission?(B(),R(Q,{key:0,modelValue:t.value,"onUpdate:modelValue":l[3]||(l[3]=s=>t.value=s),class:"ml-2 align-middle",label:e.$t("globalData"),border:!0,onChange:l[4]||(l[4]=()=>i())},null,8,["modelValue","label"])):M("",!0),a(n($e),{name:"org",class:"ml-2"})]),T("div",De,[ne((B(),R(W,{ref_key:"table",ref:q,"row-key":"id",data:b.value,"expand-row-keys":L.value,onSelectionChange:l[5]||(l[5]=s=>c.value=s),onRowDblclick:l[6]||(l[6]=s=>z(s.id)),onSortChange:C},{default:u(()=>[a(n(Ve),{name:"org"},{default:u(()=>[a(V,{type:"selection",selectable:j,width:"45"}),a(V,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120"},{default:u(({row:s})=>{var A;return[I(D(w.value?(A=s.names)==null?void 0:A.join(" / "):s.name),1)]}),_:1},8,["label"]),a(V,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100"},null,8,["label"]),a(V,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100"},null,8,["label"]),a(V,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom"},null,8,["label"]),a(V,{property:"id",label:"ID",width:"80",sortable:"custom"}),a(V,{label:e.$t("table.action"),width:"160"},{default:u(({row:s})=>[a(v,{type:"primary",disabled:n(S)("org:create"),size:"small",link:"",onClick:()=>m(s.id)},{default:u(()=>[I(D(e.$t("addChild")),1)]),_:2},1032,["disabled","onClick"]),a(v,{type:"primary",disabled:n(S)("org:update"),size:"small",link:"",onClick:()=>z(s.id)},{default:u(()=>[I(D(e.$t("edit")),1)]),_:2},1032,["disabled","onClick"]),a($,{title:e.$t("confirmDelete"),onConfirm:()=>G([s.id])},{reference:u(()=>[a(v,{type:"primary",disabled:!j(s)||n(S)("org:delete"),size:"small",link:""},{default:u(()=>[I(D(e.$t("delete")),1)]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data","expand-row-keys"])),[[X,h.value]])]),a(Ce,{modelValue:d.value,"onUpdate:modelValue":l[7]||(l[7]=s=>d.value=s),"bean-id":f.value,"bean-ids":O.value,"parent-id":o.value,"show-global-data":t.value,onFinished:i},null,8,["modelValue","bean-id","bean-ids","parent-id","show-global-data"])])}}});export{Ee as default};
