import{d as A,u as H,r as l,a6 as L,o as P,b as m,c as R,e as B,I as T,k as _,i as a,w as s,g as U,f as q,aw as F,E as d,j as i,ae as K,l as u,t as c,an as w,ab as O,aZ as Z,U as G,a_ as J}from"./index-b174b04d.js";import{L as Q,M as W,N as X,K as x,O as ee,P as ae}from"./FileSaver.min-13897a7f.js";import{_ as te}from"./ColumnList.vue_vue_type_script_lang-d04d1203.js";const se=_("i",{class:"el-icon-s-data"},null,-1),le={class:"mt-3 app-block"},oe={style:{color:"#0099ff"}},ne={name:"BackupDatabaseList"},ue=A({...ne,setup(ie){H();const C=l({}),v=l();l(1),l(10),l(0);const g=l(!1),$=l(),y=l([]),k=l([]),D=l(!1),M=l(!1),f=l(!1),N=l();L(()=>y.value.map(e=>e.id));const b=async e=>{(e==null||e)&&(D.value=!0);try{y.value=await Q({...F(C.value),sort:v.value})}finally{(e==null||e)&&(D.value=!1)}};P(b);const E=({column:e,prop:t,order:n})=>{var r;t&&n?v.value=((r=e.sortBy)!=null?r:t)+(n==="descending"?"_desc":""):v.value=void 0,b()},S=async()=>{const e=d({message:"备份中... 请稍等",type:"info",offset:16,duration:0,showClose:!1});f.value=!0,await W(),f.value=!1,e.close(),d.success("备份成功！"),b()},z=async e=>{const t=J.service({lock:!0,text:"正在恢复数据库，请稍候...",background:"rgba(0, 0, 0, 0.7)"});f.value=!0;try{const n=await ae(e);console.log(n),d.success("数据库恢复成功！")}catch(n){console.error(n),d.error("数据库恢复失败！")}finally{t.close(),f.value=!1}},I=async e=>{g.value=!0;try{const t=await X("/",[e]);x.saveAs(t,e+".zip")}finally{g.value=!1}d.success("开始下载"+e),N.value=e,M.value=!0},h=async e=>{await ee(e),b(),d.success("已删除")};return(e,t)=>{const n=m("el-button"),r=m("el-popconfirm"),p=m("el-table-column"),V=m("el-icon"),Y=m("el-table"),j=R("loading");return B(),T("div",null,[_("div",null,[a(r,{title:e.$t("confirmBackup"),width:170,onConfirm:t[0]||(t[0]=()=>S())},{reference:s(()=>[a(n,{type:"primary",disabled:f.value,icon:i(K)},{default:s(()=>[u(c(e.$t("backup")),1)]),_:1},8,["disabled","icon"])]),default:s(()=>[u(c(e.$t("backup"))+"> ",1)]),_:1},8,["title"]),a(r,{title:e.$t("confirmDelete")+"删除后无法还原!",onConfirm:t[1]||(t[1]=()=>h(k.value.map(o=>o.id)))},{reference:s(()=>[a(n,{disabled:k.value.length<=0||i(w)("backupDatabase:delete"),icon:i(O)},{default:s(()=>[u(c(e.$t("delete")),1)]),_:1},8,["disabled","icon"])]),_:1},8,["title"]),se]),_("div",le,[U((B(),q(Y,{ref_key:"table",ref:$,data:y.value,onSelectionChange:t[2]||(t[2]=o=>k.value=o),onRowDblclick:t[3]||(t[3]=o=>I(o.origName)),onSortChange:E},{default:s(()=>[a(i(te),{name:"backupDatabase"},{default:s(()=>[a(p,{type:"selection",width:"38"}),a(p,{label:"名称","min-width":"120",sortable:"custom"},{default:s(o=>[a(V,{style:{color:"#0099ff"}},{default:s(()=>[a(i(Z))]),_:1}),_("span",oe," "+c(o.row.name),1)]),_:1}),a(p,{property:"date",label:"创建日期","min-width":"120",sortable:"custom",display:"none","show-overflow-tooltip":""},{default:s(({row:o})=>[u(c(i(G)(o.lastModified).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),a(p,{property:"size",label:"大小","min-width":"80",sortable:"custom","show-overflow-tooltip":""}),a(p,{label:e.$t("table.action")},{default:s(({row:o})=>[a(r,{title:e.$t("backupTemplates.confirm.restore"),width:290,onConfirm:()=>z(o.origName)},{reference:s(()=>[a(n,{type:"primary",disabled:i(w)("backupDatabase:delete"),size:"small",link:""},{default:s(()=>[u(c(e.$t("backupDatabase.op.restore")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"]),a(r,{title:e.$t("confirmDelete"),onConfirm:()=>h([o.id])},{reference:s(()=>[a(n,{type:"primary",disabled:i(w)("backupDatabase:delete"),size:"small",link:""},{default:s(()=>[u(c(e.$t("delete")),1)]),_:1},8,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:1},8,["label"])]),_:1})]),_:1},8,["data"])),[[j,D.value]])])])}}});export{ue as default};
